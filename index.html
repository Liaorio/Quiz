<!DOCTYPE>
<html>
<meta charset="utf-8"></meta>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Example</title>
<link rel="stylesheet" type="text/css" href="vendor/slick/slick.css">
<link rel="stylesheet" type="text/css" href="vendor/slick/slick-theme.css">
<link rel="stylesheet" type="text/css" href="./style.css">
</head>

<body>

<!-- Dependencies -->
<div class="quiz-container-outer">
    <div class="quiz-container-inner">

        <div class="quiz-title">
            <div class="quiz-main-title">
                Quiz of the week's news
            </div>
            <div class="quiz-sub-title">
                It's the weekly news quiz - have you been playing attention to what's has been going on in the world
                over the past seven days?
            </div>

        </div>

        <div class="slick-part">

        </div>

        <div class="quiz-result">

        </div>
    </div>
</div>


<script src="vendor/jquery-3.2.1.min.js"></script>
<script src="vendor/slick/slick.js" charset="utf-8"></script>
<script src="vendor/jquery.lazyload.js"></script>
<script>
    $.ajaxSettings.async = false;
    
    $.getJSON("./example.json",function(data) {

        var questions = data.questions;
        var number = questions.length;

        $.each(questions, function(key, val) {

            //题目页面
            $('.slick-part').append(
                "<div class='slick-item'>" +
                    "<div class='quiz-image'>" +
                        "<img class='lazy' data-original='./asset/t"+ key +".jpg' width='100%' height='200px'>" +
                    "</div>" +
                    "<div class='quiz-question'>" +
                        "<div class='quiz-question-num-container'>" +
                            "<div class='quiz-question-num'>" + (key + 1) + "</div>" +
                        "</div>" +
                        "<div class='quiz-question-text'>" +
                            val.question +
                        "</div>" +
                        "<div class='quiz-question-options'>" +
                            "<ul id='question_" + key + "'>" +
                                "<li id='question_"+ key +"_1_li'>" +
                                    "<input type='radio' name='question_" + key + "' id='question_" + key + "_1_option'>" +   val.options[0] +
                                "</li>" +
                                "<li id='question_" + key + "_2_li'>" +
                                    "<input type='radio' name='question_" + key + "' id='question_" + key + "_2_option'>" +   val.options[1] +
                                "</li>" +
                                "<li id='question_" + key + "_3_li'>" +
                                    "<input type='radio' name='question_" + key + "' id='question_" + key + "_3_option'>" +   val.options[2] +
                                "</li>" +
                                "<li id='question_" + key + "_4_li'>" +
                                    "<input type='radio' name='question_" + key + "' id='question_" + key + "_4_option'>" +   val.options[3] +
                                "</li>" +
                            "</ul>" +
                        "</div>" +
                    "</div>" +
                    "<div class='nextButton' id='next_"+ key +"'>" + "Next" + "</div>" +
                "</div>"
            );

            //题目答案页面
            $(".quiz-result").append(
                "<div id='result_question_" + key + "'>" + "</div>"
            );

        });

        //结果页面
        $('.slick-part').append(
            "<div class='slick-item'>" +
                "<div class='score-div'>" +
                    "<h1>" + "Your Score" +
                        "<div class='score-part'>" +
                            "<span class='score'>" + 0 + "</span>" + "&nbsp;&nbsp;of&nbsp;&nbsp;" + number +
                        "</div>" +
                        "Share the result" +
                    "</h1>" +
                "</div>" +
            "</div>"
        );

        $(".quiz-result").append(
            "<div id='result_question_last'>" + "</div>"
        );


    });


    $(document).ready(function () {

        var score = 0;

        $("img.lazy").lazyload();

        $('.slick-part').slick({
            dots: false,
            draggable: false,
            infinite: false,
            asNavFor: '.quiz-result',
            nextArrow: $('.nextButton'),
        });

        $('.quiz-result').slick({
            asNavFor:'.slick-part',
            infinite: false,
            fade: true,
            arrows: false,
        });

        $('.quiz-question-options ul li').click(function (e) {

            //input选中
            let option_input = e.target.childNodes[0] ? e.target.childNodes[0] : e.target;
            let option_input_id = option_input.getAttribute("id");
            $('#' + option_input_id).attr('checked',true);

            //li背景颜色改变
            let option_li = e.target.parentNode.nodeName == 'LI' ? e.target.parentNode : e.target;
            let option_li_id = option_li.getAttribute('id');
            $('#' + option_li_id).css('background','#B4A24E');

            //ul不能被点击
            let question_id = option_input.getAttribute("name");
            $("#" + question_id).css('pointer-events','none');
            $("#" + question_id).css('color','#efefef');

            //答案显示
            let question_answered = option_input_id.split('_')[1];
            let option_choose = option_input_id.split('_')[2];

            $.ajaxSettings.async = false;

            $.getJSON("./example.json",function(data) {
                let question = data.questions[question_answered];
                let result = question.result[option_choose-1];
                let feedback = question.feedback[option_choose-1];

                $('#result_question_' + question_answered ).append(
                    "<div class='quiz-result-title'>" + result + "</div>" +
                    "<div class='quiz-result-text'>" +  feedback + "</div>"
                )

                score = score + question.score[option_choose-1];
            })

            //nextButton显示
            $("#next_" + question_answered).css('visibility','visible');

            //分数显示
            $(".score").html(score);
        })

    })
</script>
</body>

</html>